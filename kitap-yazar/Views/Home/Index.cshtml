<html>
<head>
	<title>.NET Core Web API</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
	<div class="container" style="margin-top:50px;">
		<div class="row">
			<div class="col-md-12">
				<div class="form-group">
					<label><h>Yazar Ekle</h> </label><br />
					<input type="text" class="form-control" id="yazarAdi" placeholder="Yazar adı giriniz.." />
				</div>
				<div class="form-group">
					<input type="button" value="Yazar Ekle" id="yazarEkleBtn" class="btn-success form-control" />
				</div><br />
				<div id="yazarMessage"></div>
			</div>
		</div>

		<div id="spinnerDiv" class="d-none justify-content-center">
			<div id="spinner" class="spinner-border" role="status">
				<span class="sr-only">Loading...</span>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12">
				<div class="form-group">
					<label><h>Kitap Ekle</h> </label><br />
					<input type="text" class="form-control" id="kitapAdi" placeholder="Kitap adı giriniz.." />

					<select id="yazarlar" class="form-control mt-2" aria-label="Default select example">
						<option selected>Yazar Seçiniz</option>

					</select>


				</div>

				<div class="form-group">
					<input type="button" value="Kitap Ekle" id="kitapEkleBtn" class="btn-success form-control" mt2 />
				</div>

				<div id="Message" class="alert alert-success" role="alert"></div>
			</div>
		</div>
		<hr />
		<div class="row">



			<table class="mt-2 table table-striped table-dark">
				<thead>
					<tr>
						<th scope="col">#</th>
						<th scope="col">Kitabın Adı</th>
						<th scope="col">Yazar</th>
					</tr>
				</thead>
				<tbody id="tableBody">
				</tbody>
			</table>


			<div class="col-md-12">
				<nav aria-label="Page navigation example">
					<ul class="pagination">
						<li class="page-item">
							<a class="page-link" href="#" aria-label="Previous">
								<span aria-hidden="true">&laquo;</span>
								<span class="sr-only">Previous</span>
							</a>
						</li>
						<li class="page-item"><a class="page-link" href="#">1</a></li>
						<li id="denemeID" class="page-item"><a class="page-link" href="#">2</a></li>
						<li class="page-item"><a class="page-link" href="#">3</a></li>
						<li class="page-item">
							<a class="page-link" href="#" aria-label="Next">
								<span aria-hidden="true">&raquo;</span>
								<span class="sr-only">Next</span>
							</a>
						</li>
					</ul>
					<div class="dropdown">
						<a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							Her Sayfada 5 Kitap
						</a>
						<div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
							<button class="dropdown-item" href="#">Her Sayfada 5 Kitap</button>
							<button class="dropdown-item active" href="#">Her Sayfada 10 Kitap</button>
							<button class="dropdown-item" href="#">Her Sayfada 20 Kitap</button>
						</div>
					</div>
				</nav>
				<button class="btn btn-success form-control mt-2" id="kitaplariGetir">Kitapları Getir</button>
			</div>
		</div>
		<hr />
		<div class="row">
			<div class="col-md-12">
				<button class="btn btn-warning form-control" id="yazarlariGetir">Yazarları Getir</button>
			</div>
			<div class="col-md-12">
				<div id="getAuthorsArea">
					<ul id="getAuthors"></ul>
				</div>
			</div>
		</div>

	</div>

	<script>
		yazarlariGetir();
		hideMessage();
		$(document).ready(function () {
			$.ajax({
				type: 'GET',
				url: '/api/service/getbooks',
				success: function (books) {
					$.each(books, function (index, value) {
						let siraNo = index + 1;
						$("#tableBody").append("<tr><td scope = 'row' >" + siraNo + "</td><td> " + value.name + "</td><td>" + value.authorName + "</td><td style = 'display:none'>" + value.bookID + "</td>< /tr>");
					})
				},
				error: function (xhr) {
					$("#Message").html("");
					$("#Message").html("<span class='text-danger'>Kitap yok!</span>");
				}
			})
		});
		function hideSpinner() {
			$("#spinner").fadeOut();
		}
		function hideMessage() {
			$("#Message").addClass("d-none")
		}
		function fadeOutMessage() {
			$("#Message").fadeOut(1000);
		}
		function showMessage() {
			$("#Message").removeClass("d-none");
			setTimeout(fadeOutMessage, 5000);
		}
		function showSpinner() {
			$("#spinnerDiv").addClass("d-flex").removeClass("d-none");
		}
		function yazarlariGetir() {
			$.ajax({
				type: 'GET',
				url: '/api/service/getallauthors',
				success: function (authors) {
					let selectList = document.getElementById("yazarlar");

					authors.forEach(author => {
						option = document.createElement("option");
						option.text = author.authorName;
						option.value = author.authorID;
						selectList.appendChild(option);
					});
				}
			});
		}
		function cleanTable() {
			$("#tableBody tr").remove();
		};
		//$("#kitaplariGetir").click(function () {
		//	cleanTable();
		//	let kitapSayisi = 10;
		//	let sayfaSayisi = $("#denemeID").val();
		//	var postData = {
		//		ks: kitapSayisi,
		//		sn: sayfaSayisi,
		//	};
		//	$.ajax({
		//		headers: {
		//			'Accept': 'application/json',
		//			'Content-Type': 'application/json'
		//		},
		//		type: 'GET',
		//		url: '/api/service/getallbooks',
		//		success: function (books) {
		//			$.each(books, function (index, value) {
		//				let siraNo = index + 1;
		//				$("#tableBody").append("<tr><td scope = 'row' >" + siraNo + "</td><td> " + value.name + "</td><td>" + value.authorName + "</td><td style = 'display:none'>" + value.bookID + "</td>< /tr>");
		//			})
		//		},
		//		error: function (xhr) {
		//			$("#Message").html("");
		//			$("#Message").html("<span class='text-danger'>Kitap yok!</span>");
		//		}
		//	});
		//});
		$("#yazarlariGetir").click(function () {
			$.ajax({
				type: 'GET',
				url: '/api/service/getallauthors',
				success: function (books) {
					$("#getAuthors").html("");
					$.each(books, function (index, value) {
						$("#getAuthors").append("<li>Yazar Adı: <b>" + value.authorName + " - Kitap Sayısı: <b>" + value.totalBook + "</b>");
					});
				}
			});
		});
		$("#yazarEkleBtn").click(function () {
			var yazarAdi = $("#yazarAdi").val();
			var postData = {
				authorName: yazarAdi,
			};

			if (yazarAdi == "") {
				alert("Yazar adı giriniz!");
			} else {
				$.ajax({
					headers: {
						'Accept': 'application/json',
						'Content-Type': 'application/json'
					},
					type: 'POST',
					url: '/api/service/postauthor',
					data: JSON.stringify(postData),
					dataType: 'JSON',
					success: function (result) {
						$("#yazarMessage").html("");
						$("#yazarMessage").html("<span class='text-success'>Yazar ekleme başarılı!</span>");
						yazarlariGetir();

					},
					error: function (xhr) {
						$("#yazarMessage").html("");
						$("#yazarMessage").html("<span class='text-danger'>Yazar ekleme başarısız!</span>");
					}
				});
			}
		});
		$("#kitapEkleBtn").click(function () {

			var kitapAdi = $("#kitapAdi").val();
			var yazar = $("#yazarlar").val();
			var yazarAdi = $("#yazarlar").select();
			var postData1 = {
				Name: kitapAdi,
				AuthorID: yazar,
				AuthorName: yazarAdi,
			}
			showSpinner();
			$.ajax({
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				},
				type: 'POST',
				url: '/api/service/postbook',
				data: JSON.stringify(postData1),
				dataType: 'JSON',
				success: function (result) {
					showMessage();
					$("#Message").html("");
					$("#Message").html("<span class='text-success'>Kitap ekleme başarılı!</span>");
					hideSpinner();
				},
				error: function (xhr) {
					showMessage();
					$("#Message").html("");
					$("#Message").html("<span class='text-danger'>Kitap ekleme başarısız!</span>");
					hideSpinner();
				}
			});
		});
	</script>
</body>
</html>